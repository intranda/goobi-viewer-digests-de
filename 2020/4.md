---
description: Goobi viewer Digest f√ºr den April 2020
---

# April

## Coming soon

* \*\*\*\*üó∫ **Karten**
* \*\*\*\*üõ† **verbesserte Bedienung im Admin-Backend**
* \*\*\*\*üíª **REST API**

## **Aktuelles**

Diesen Monat gibt es vor allem aus der Entwicklung selbst zu berichten. Die neuen M√∂glichkeiten mit den Karten sind hier ein echtes Highlight!

Wichtig ist, dass mit dem Update auf die Version 4.6 auch ein Update des Goobi viewer Indexers und die Neuindexierung des Datenbestandes notwendig ist. Im Widget "Zitieren und Nachnutzen" werden ansonsten aufgrund einer ver√§nderten Logik nicht mehr alle Optionen angezeigt.

## **Entwicklungen**

### **Karten**

Im Backend gibt es einen neuen Bereich "Karten". Dort k√∂nnen Karten entweder manuell oder basierend auf einer Solr-Query angelegt und verwaltet werden. Diese stehen anschlie√üend in dem neuen CMS-Template "Text und Karte" oder in allen Templates als Widget in der Seitenleiste zur Verf√ºgung.

![&#xDC;bersicht &#xFC;ber die vorhandenen Karten im Backend](../.gitbook/assets/2020-04_backend_map_overview.png)

Bei der manuellen Definition von Karten k√∂nnen beliebig viele Marker gesetzt werden. Pro Marker kann ein Titel und ein Text eingegeben werden. Neben der Unterst√ºtzung der Mehrsprachigkeit kann in dem Text auch HTML verwendet werden, um zum Beispiel Links zu weiteren Seiten zu hinterlegen.

![Marker und Inhalte des Popups k&#xF6;nnen manuell definiert werden.](../.gitbook/assets/2020-04_backend_map_manual.png)

Sofern im Solr Suchindex Werke mit indexierten Koordinaten vorliegen, kann auf dieser Basis ebenfalls eine Karte generiert werden. Daf√ºr wird pro Treffer ein Marker angezeigt. Sind f√ºr einen Punkt mehrere Treffer vorhanden, so werden diese automatisch zusammengefasst. 

![Karten k&#xF6;nnen auf Basis von indexierten Koordinaten automatisch generiert werden.](../.gitbook/assets/2020-04_backend_map_automatic.png)

Mit dem neuen "Karten"-Widget f√ºr die Seitenleiste ist das bisherige Widget "Geokoordinaten" komplett entfallen. Eine Migration von bestehenden Konfigurationen zu der neuen Karten-Funktionalit√§t existiert nicht. Sofern das "Geokoordinaten"-Widget in Verwendung war, m√ºssen die konfigurierten Punkte nach einem Update als Karte neu angelegt und mit dem neuen Widget zur Seitenleiste hinzugef√ºgt werden. Da die Verwendung des Geokoordinaten-Widgets mit der manuellen Eingabe von Latitude und Longitude Werte sehr umst√§ndlich war, gehen wir davon aus, dass nur _sehr_ wenige Installationen betroffen sind.

![Beispiel f&#xFC;r die Anzeige einer neue Karte in der Seitenleiste](../.gitbook/assets/2020-04_frontend_map_sidebar.png)

### Datens√§tze ohne Bilder

Die Unterst√ºtzung f√ºr Werke ohne Bilder und Strukturdaten wurde noch einmal verbessert. Getreu dem Motto "Zeige nur das an was auch Sinn ergibt" wurde das bestehende Verhalten evaluiert und verschiedene √Ñnderungen umgesetzt. 

Bisher wurde zum Beispiel in den Suchtreffern ein Platzhalterbild mit dem Hinweis angezeigt, dass kein Bild geladen werden konnte. In Installationen, in denen nur Datens√§tze ohne Bilder enthalten sind, ergibt das nat√ºrlich keinen Sinn. Anstelle dessen wird nun einfach das Thumbnail f√ºr die betreffenden Datens√§tze komplett ausgeblendet und den daneben liegenden Metadaten mehr Platz einger√§umt.

Wenn keine Bilder vorhanden sind, wurde schon immer die Seite "Bibliographische Daten" aufgerufen. Existiert sonst keine weitere Seite f√ºr das komplette Werk, wird hier als √úberschrift anstelle von "Bibliographische Daten" ab jetzt der Titel des Werkes angezeigt.

![Beispiel f&#xFC;r die Anzeige eines Werkes das nur aus Metadaten besteht](../.gitbook/assets/2020-04_metadata_only_record.png)

### St√∂bern

In der St√∂bern Funktionalit√§t konnte bisher nur der indexierte Wert angeboten werden. Bei Metadaten wie Personen- oder Ortsnamen ist das kein Problem. Werden jedoch intern Sprachcodes nach ISO-639-2b wie zum Beispiel `ger`, `eng`, `fre` oder L√§ndercodes nach ISO-3166-1-alpha2 wie zum Beispiel  `DE`, `EN`, `FR` gespeichert, dann ergab das St√∂bern hier wenig Sinn.

Mit dem neuen Attribut `translate="true"` in der Felddefinition f√ºr das St√∂bern k√∂nnen diese Felder nun √ºbersetzt werden. 

{% code title="config\_viewer.xml" %}
```markup
<metadata>
  <browsingMenu>
    <luceneField translate="true">MD_LANGUAGE</luceneField>
  </browsingMenu>
</metadata>
```
{% endcode %}

Achtung: Die √úbersetzung ben√∂tigt Rechenzeit und sollte aus Performancegr√ºnden nur bei kleineren Datenmengen, wie den oben angegebenen Normdaten-Beispielen verwendet werden.

### Zitierlinks f√ºr Bildausschnitte

Die im Januar vorgestellt Funktionalit√§t der Zitierlinks f√ºr Bildausschnitte wurde noch einmal in seiner Bedienung verbessert. Nach dem Aktivieren der Funktionalit√§t √ºber das Icon oberhalb der Bildanzeige werden in dem selben Popover auch die generierten Links angezeigt und k√∂nnen per Klick in die Zwischenablage kopiert werden.

Zus√§tzlich kann auch die Gr√∂√üe des Rahmens nun bis zum Schlie√üen des Popovers noch ver√§ndert werden.

![Links werden nun im Popover angezeigt und die Rahmen k&#xF6;nnen ver&#xE4;ndert werden.](../.gitbook/assets/2020-04_share_image_region_2.png)

In der Vollbildanzeige ist die Funktionalit√§t nun in der Seitenleiste verf√ºgbar:

![Zitierlinks f&#xFC;r Bildausschnitte k&#xF6;nnen in der Vollbildanzeige in der Seitenleiste ausgew&#xE4;hlt werden.](../.gitbook/assets/2020-04_share_image_region_fullscreen.png)

### PDF-Dateien

Der Goobi viewer generiert PDF-Dateien "on-the-fly" und greift daf√ºr auf den ContentServer zur√ºck. Schon l√§nger gab es in der Community Kritik, dass die generierten PDF-Dateien schnell sehr gro√ü werden k√∂nnen.

Mit der Version 4.6 verwendet der Goobi viewer eine neue ContentServer Version, die zwei neue, optionale Schalter mitbringt um auf die Gr√∂√üe der generierten PDF Dateien Einfluss zu nehmen:

{% code title="config\_contentServer.xml" %}
```text
imageScale="0.5"
imageCompression="50"
```
{% endcode %}

Mit dem Schalter `imageScale=""` wird angegeben, wie viel das Bild gegen√ºber seiner Originalgr√∂√üe skaliert werden soll. Der Schalter `imageCompression=""` definiert wie stark die JPEG Dateien komprimiert werden. Die oben angegebenen Werte sind die neuen Standartwerte.

In Zahlen bedeutet das, dass unser Testwerk mit 120 Bildern und hinterlegtem Volltext vorher 514,3MB und unter der Verwendung der oben angegebenen Schalter nur noch 88,7MB gro√ü ist. 

Die Gr√∂√üe der generierten PDF-Datei konnte um. 83 Prozent reduziert werden!

### Gruppierung von Treffern auf CMS-Seiten

Gemeinsam von zwei Anwendern wurde die Gruppierung von Treffern auf CMS-Seiten beauftragt. Diese neue Funktionalit√§t steht in den CMS-Templates "Text mit Suchtreffern" und "Akkordeon Sammlungsansicht" zur Verf√ºgung. Ist ein Gruppierfeld ausgew√§hlt, werden die Inhalte nach den Werten des Feldes zusammengefasst angezeigt, zum Beispiel nach Jahr oder nach Subtheme. Felder, bei denen mehrere Werte m√∂glich sind, stehen f√ºr die Gruppierung nicht zur Verf√ºgung.

![Gruppierung der Sammlungen nach Partner](../.gitbook/assets/2020-04_grouped_hits_1.png)

![Gruppierung von Werken nach Erscheinungsjahr](../.gitbook/assets/2020-04_grouped_hits_2.png)

### Verbesserte Registrierung von Benutzeraccounts

Anfang Mai wurde in vielen Goobi viewer Installationen die massenhafte automatische Registrierung von SPAM Benutzeraccounts beobachtet. Als kurzfristige L√∂sung musste der Emailversand im Goobi viewer deaktiviert werden.

Als direkte Konsequenz auf den Vorfall wurden verschiedene Verbesserungen integriert, die die automatische Registrierung in Zukunft verhindern.

Die einzig sichtbare Neuerung ist eine Sicherheitsfrage im Formular f√ºr die Benutzerregistrierung. Die Fragen sind bewusst trivial gew√§hlt und k√∂nnen durch einen Menschen sehr einfach beantwortet werden. SPAM Bots scheitern allerdings daran. Ein Vorteil dieser Variante liegt in der Barrierefreiheit: Captchas mit Bildern sind nur dann barrierefrei wenn sie auch als Audiodatei angeboten werden. Auf externe Dienste wollten wir verzichten.

Unsichtbare Neuerungen sind zum Beispiel ein sogenanntes "Honeypot-Feld". Daf√ºr wurde in das Formular ein zus√§tzliches Feld integriert, dass in der Oberfl√§che √ºber Styling Anweisungen ausgeblendet ist. Menschen k√∂nnen das Feld also nicht ausf√ºllen weil sie es nicht sehen. SPAM Bots orientieren sich aber am Seitenquelltext. Wird das Feld also ausgef√ºllt, muss es sich bei der Registrierung um einen SPAM Bot handeln.  
Zus√§tzlich wurden im Quelltext weitere √úberpr√ºfungen hinzugef√ºgt und Logging erg√§nzt, das bei der Diagnose Anfang Mai geholfen h√§tten.

Das Pool an Sicherheitsfragen und daf√ºr erlaubten Antworten kann in der Konfigurationsdatei angepasst werden. Standardm√§√üig werden drei Fragen und entsprechende Antworten ausgeliefert.  Weitere Vorschl√§ge f√ºr entsprechende Fragen und eine Erkl√§rung zur Konfiguration gibt es in der Dokumentation [Kapitel 2.5.3](https://docs.goobi.io/goobi-viewer-de/2/2.5/2.5.3).

![Im Formular f&#xFC;r die Registrierung von neuen Benutzeraccounts gibt es eine neue Sicherheitsabfrage](../.gitbook/assets/2020-04_new_security_on_create_user_account_form.png)

### CMS: Verbesserte FAQ Templates

Die CMS Templates zum Erstellen einer FAQ wurden √ºberarbeitet. In FAQ Beitr√§gen k√∂nnen nun auch Bilder enthalten sein. Die Inline-Hilfe wurde komplett neu geschrieben und das Styling der Seiten wurde verbessert.

### Zeitleiste

Eine der Einstiege in die Inhalte den Datenbestand ist die Zeitleiste. Die Funktionalit√§t war in seiner jetzigen Form in die Jahre gekommen. Die Bedienung war umst√§ndlich, die Ladezeiten zu lang und Benutzer wussten auch nicht ob und wenn ja was passiert.

Aus diesem Grund kam der Zeitleiste ein Fr√ºhjahrsputz zugute und sie erstrahlt nun in neuem Glanz.. Die technologische Basis ist jetzt modern, die Anzeige deutlich schlanker und Inhalte werden viel schneller angezeigt. Mit der M√∂glichkeit die maximale Trefferzahl selber festzulegen ist auch eine neue Funktionalit√§t hinzugekommen.

F√ºr die Anpassung des einleitenden Textes steht auch ein neues CMS-Template zur Verf√ºgung.

![Die Zeitleiste wurde erneuert und ist deutlich angenehmer zu bedienen.](../.gitbook/assets/2020-04_timematrix_refactoring.png)

### Sonstiges

* Eine erste Implementierung f√ºr **SAML** ist in den Core eingeflossen und kann als neuer IdentityProvider, zum Beispiel f√ºr **Shibboleth** konfiguriert werden. Eventuell sind hier bei der lokalen Inbetriebnahme noch weitere Anpassungen am Code notwendig.
* Es wird nun bei der Anzeige von **Volltexten** unterschieden, ob die Dateien im Textformat oder als HTML vorliegen. **Die Anzeige von HTML wurde optimiert**.
* Im Widget "**Zitieren und Nachnutzen**" wird im dem **Badge f√ºr den PDF-Download** nun ein **zus√§tzliches Icon** angezeigt um diese wichtige Funktionalit√§t schneller visuell zu finden. 
* Im Widget "**Zitieren und Nachnutzen**" wird anstelle der √úberschrift "Strukturelement" jetzt der **Name des Strukturelements angezeigt**, also zum Beispiel "Kapitel", "Titelblatt" "Einband" oder "Inhaltsverzeichnis".

### Goobi viewer Indexer

Der Goobi viewer Indexer wurde um die M√∂glichkeit der Indexierung von Geokoordinaten erweitert. Siehe dazu auch [Kapitel 3.7.19](https://docs.goobi.io/goobi-viewer-de/3/3.7/#3-7-19-parameter-geojsonsource) in der Dokumentation.

## Versionsnummern

Die Versionen die in der `pom.xml` des Themes eingetragen werden m√ºssen um die in diesem Digest beschriebenen Funktionen zu erhalten lauten:

```markup
<dependency>
    <groupId>io.goobi.viewer</groupId>
    <artifactId>viewer-core</artifactId>
    <version>4.6.0</version>
</dependency>
<dependency>
    <groupId>io.goobi.viewer</groupId>
    <artifactId>viewer-core-config</artifactId>
    <version>4.6.2</version>
</dependency>
```

Der **Goobi viewer Indexer** hat die Versionsnummer **4.6.0**.

Der **Goobi viewer Connector** hat die Versionsnummer **4.6.0**.

Das **Goobi viewer Crowdsourcing Modul** hat die Versionsnummer **1.4.0**.

